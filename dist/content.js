const d={enabled:!0,branchNameStructure:"${prefix}/TP-${id}-${slug}"},l="branchNameGeneratorSettings";async function g(){try{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local){const e=await chrome.storage.local.get(l);if(e[l])return{...d,...e[l]}}else{const e=localStorage.getItem(l);if(e)return{...d,...JSON.parse(e)}}}catch(e){console.warn("Failed to load settings:",e)}return{...d}}async function k(){return(await g()).enabled}async function w(){return(await g()).branchNameStructure}function y(e){switch(e.toLowerCase()){case"epic":return"epic";case"feature":return"feat";case"suggestion":return"suggestion";case"bug":return"fix";case"product":return"item";case"task":return"task";default:return"misc"}}function x(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}async function S({type:e,id:o,title:t}){const r=y(e),n=x(t);return(await w()).replace(/\$\{prefix\}/g,r).replace(/\$\{id\}/g,o).replace(/\$\{slug\}/g,n)}function E({type:e,id:o,title:t}){const r=y(e),n=x(t).replace(/-/g," "),a=`${r}: ${n}`,c=`${r==="fix"?"Fixes":"Implements"}: #${o}`;return`${a}

${c}`}function v(e,o){const t={branch:o,savedAt:new Date().toISOString()};localStorage.setItem(`branchName-${e}`,JSON.stringify(t))}function I(e){try{return JSON.parse(localStorage.getItem(`branchName-${e}`))}catch{return null}}function f(){const e=document.querySelector('input[aria-label="Title field"]')?.value?.trim()||"untitled-task",t=document.querySelector(".work-item-form-header a")?.textContent?.trim().toLowerCase()||"task",r=t.match(/(\d+)/),n=r?r[1]:"0000";let a="task";return t.includes("bug")?a="bug":t.includes("feature")?a="feature":t.includes("epic")?a="epic":t.includes("suggestion")?a="suggestion":t.includes("product")&&(a="product"),{type:a,id:n,title:e}}function m(e,o,t,r){const n=document.createElement("button");n.id=e,n.className="bolt-button bolt-icon-button enabled bolt-focus-treatment",n.setAttribute("role","button"),n.setAttribute("aria-label",t),n.style.cssText=`
    display: inline-flex;
    align-items: center;
    padding: 0px;
    font-size: 12px;
    background-color: transparent;
    width: min-content;
    transition: background-color 0.3s ease;
  `,n.addEventListener("mouseenter",()=>{n.style.backgroundColor="var(--palette-black-alpha-6,rgba(0, 0, 0, 0.06))"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="transparent"});const a=document.createElement("span");a.className="fluent-icons-enabled";const c=document.createElement("span");return c.className=`left-icon flex-noshrink fabric-icon ${o} medium`,c.setAttribute("aria-hidden","true"),c.style.padding="0",a.appendChild(c),n.appendChild(a),n.onclick=r,n}function N(e){const o=document.createElement("button");return o.id="commit-copy-button",o.className="bolt-button bolt-default-button bolt-focus-treatment",o.style.cssText="margin-left: 10px; padding: 0px 6px; font-size: 12px;",o.innerText="Copy Commit Msg",o.onclick=()=>{const t=E(e);navigator.clipboard.writeText(t).then(()=>{const r=o.innerText;o.innerText="âœ“",setTimeout(()=>{o.innerText=r},5e3)})},o}function $(e){const o=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),t=new Date,r=new Date(e),n=Math.round((r.getTime()-t.getTime())/1e3),a=[{limit:60,divisor:1,unit:"second"},{limit:3600,divisor:60,unit:"minute"},{limit:86400,divisor:3600,unit:"hour"},{limit:604800,divisor:86400,unit:"day"},{limit:2419200,divisor:604800,unit:"week"},{limit:29030400,divisor:2419200,unit:"month"},{limit:1/0,divisor:29030400,unit:"year"}],c=Math.abs(n);for(const i of a)if(c<i.limit){const s=Math.round(n/i.divisor);return o.format(s,i.unit)}return""}function p(e=1500){const o=document.querySelector("#copy-branch-name-btn");if(!o)return;const t=o.querySelector(".ms-Icon--Copy");t&&(t.classList.replace("ms-Icon--Copy","ms-Icon--CheckMark"),setTimeout(()=>{t.classList.replace("ms-Icon--CheckMark","ms-Icon--Copy")},e))}function B(e,o,t){const r=document.createElement("div");r.id="branch-name-inline",r.style.cssText=`
    margin-left: 10px;
    font-family: monospace;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 8px;
  `;const n=document.createElement("code");n.style.cssText=`
    height: 100%;
  `,n.textContent=e;const a=m("copy-branch-name-btn","ms-Icon--Copy","Copy branch name",()=>{navigator.clipboard.writeText(e).then(()=>{p()})}),c=m("regenerate-branch-name-btn","ms-Icon--Refresh","Regenerate branch name",async()=>{const C=f(),u=await S(C);v(o,u),r.remove(),b(u,o,new Date().toISOString()),navigator.clipboard.writeText(u).then(()=>{p()})}),i=m("delete-branch-name-btn","ms-Icon--Delete","Delete branch name",()=>{localStorage.removeItem(`branchName-${o}`),r.remove(),T(o)}),s=document.createElement("span");return s.style.cssText="font-size: 11px; color: #888;",s.textContent=`saved ${$(t)}`,r.appendChild(n),r.appendChild(a),r.appendChild(c),r.appendChild(i),r.appendChild(s),r}function b(e,o,t){const r=document.querySelector("#branch-name-inline");r&&r.remove();const n=document.querySelector(".work-item-form-header a");if(!n)return;const a=f(),c=B(e,o,t),i=N(a);c.appendChild(i),n.parentElement.appendChild(c)}function T(e){const o=document.querySelector(".work-item-form-header a");if(!o||document.querySelector("#branch-name-generate"))return;const t=document.createElement("button");t.id="branch-name-generate",t.className="bolt-button bolt-default-button bolt-focus-treatment",t.style.cssText="margin-left: 10px; padding: 0px 6px; font-size: 12px;",t.innerText="Generate Branch Name",t.onclick=async()=>{const r=f(),n=await S(r),a=new Date().toISOString();v(e,n),b(n,e,a),navigator.clipboard.writeText(n).then(()=>{p()}),t.remove()},o.parentElement.appendChild(t)}function L(){new MutationObserver(o=>{o.forEach(t=>{t.type==="childList"&&t.addedNodes.forEach(r=>{if(r.nodeType===Node.ELEMENT_NODE){const n=r.querySelector('input[aria-label="Title field"]'),a=r.querySelector(".work-item-form-header a");(n||a)&&setTimeout(async()=>{await h()},100)}})})}).observe(document.body,{childList:!0,subtree:!0})}async function h(e=0){if(!await k())return;const o=document.querySelector('input[aria-label="Title field"]'),t=document.querySelector(".work-item-form-header a");if(o&&t){const r=t.textContent.match(/(\d+)/),n=r?r[1]:null;if(!n)return;const a=I(n);a?.branch&&a?.savedAt?b(a.branch,n,a.savedAt):T(n)}else e<10&&setTimeout(()=>h(e+1),500)}L();h();

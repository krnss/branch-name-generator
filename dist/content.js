const d={enabled:!0,branchNameStructure:"${prefix}/TP-${id}-${slug}"},l="branchNameGeneratorSettings";async function g(){try{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local){const e=await chrome.storage.local.get(l);if(e[l])return{...d,...e[l]}}else{const e=localStorage.getItem(l);if(e)return{...d,...JSON.parse(e)}}}catch(e){console.warn("Failed to load settings:",e)}return{...d}}async function w(){return(await g()).enabled}async function I(){return(await g()).branchNameStructure}function y(e){switch(e.toLowerCase()){case"epic":return"epic";case"feature":return"feat";case"suggestion":return"suggestion";case"bug":return"fix";case"product":return"item";case"task":return"task";default:return"misc"}}function x(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}async function v({type:e,id:t,title:n}){const r=y(e),o=x(n);return(await I()).replace(/\$\{prefix\}/g,r).replace(/\$\{id\}/g,t).replace(/\$\{slug\}/g,o)}function N({type:e,id:t,title:n}){const r=y(e),o=x(n).replace(/-/g," "),a=`${r}: ${o}`,c=`${r==="fix"?"Fixes":"Implements"}: #${t}`;return`${a}

${c}`}function C(e,t){const n={branch:t,savedAt:new Date().toISOString()};localStorage.setItem(`branchName-${e}`,JSON.stringify(n))}function T(e){try{return JSON.parse(localStorage.getItem(`branchName-${e}`))}catch{return null}}function f(){const e=document.querySelector('input[aria-label="Title field"]')?.value?.trim()||"untitled-task",n=document.querySelector(".work-item-form-header a")?.textContent?.trim().toLowerCase()||"task",r=n.match(/(\d+)/),o=r?r[1]:"0000";let a="task";return n.includes("bug")?a="bug":n.includes("feature")?a="feature":n.includes("epic")?a="epic":n.includes("suggestion")?a="suggestion":n.includes("product")&&(a="product"),{type:a,id:o,title:e}}function m(e,t,n,r){const o=document.createElement("button");o.id=e,o.className="bolt-button bolt-icon-button enabled bolt-focus-treatment",o.setAttribute("role","button"),o.setAttribute("aria-label",n),o.style.cssText=`
    display: inline-flex;
    align-items: center;
    padding: 0px;
    font-size: 12px;
    background-color: transparent;
    width: min-content;
    transition: background-color 0.3s ease;
  `,o.addEventListener("mouseenter",()=>{o.style.backgroundColor="var(--palette-black-alpha-6,rgba(0, 0, 0, 0.06))"}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor="transparent"});const a=document.createElement("span");a.className="fluent-icons-enabled";const c=document.createElement("span");return c.className=`left-icon flex-noshrink fabric-icon ${t} medium`,c.setAttribute("aria-hidden","true"),c.style.padding="0",a.appendChild(c),o.appendChild(a),o.onclick=r,o}function E(e){const t=document.createElement("button");return t.id="commit-copy-button",t.className="bolt-button bolt-default-button bolt-focus-treatment",t.style.cssText="margin-left: 10px; padding: 0px 6px; font-size: 12px;",t.innerText="Copy Commit Msg",t.onclick=()=>{const n=N(e);navigator.clipboard.writeText(n).then(()=>{const r=t.innerText;t.innerText="âœ“",setTimeout(()=>{t.innerText=r},5e3)})},t}function $(e){const t=document.createElement("button");return t.id="pull-request-button",t.className="bolt-button bolt-default-button bolt-focus-treatment",t.style.cssText="margin-left: 10px; padding: 0px 6px; font-size: 12px;",t.innerText="Create PR",t.onclick=()=>{const n=T(e.id)?.branch||"",o=`https://timepoint-vsts.visualstudio.com/eTimePlus/_git/timepoint-etimeplus/pullrequestcreate?sourceRef=${encodeURIComponent(n)}&targetRef=${encodeURIComponent("develop")}`;window.open(o,"_blank")},t}function B(e){const t=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),n=new Date,r=new Date(e),o=Math.round((r.getTime()-n.getTime())/1e3),a=[{limit:60,divisor:1,unit:"second"},{limit:3600,divisor:60,unit:"minute"},{limit:86400,divisor:3600,unit:"hour"},{limit:604800,divisor:86400,unit:"day"},{limit:2419200,divisor:604800,unit:"week"},{limit:29030400,divisor:2419200,unit:"month"},{limit:1/0,divisor:29030400,unit:"year"}],c=Math.abs(o);for(const i of a)if(c<i.limit){const s=Math.round(o/i.divisor);return t.format(s,i.unit)}return""}function p(e=1500){const t=document.querySelector("#copy-branch-name-btn");if(!t)return;const n=t.querySelector(".ms-Icon--Copy");n&&(n.classList.replace("ms-Icon--Copy","ms-Icon--CheckMark"),setTimeout(()=>{n.classList.replace("ms-Icon--CheckMark","ms-Icon--Copy")},e))}function q(e,t,n){const r=document.createElement("div");r.id="branch-name-inline",r.style.cssText=`
    margin-left: 10px;
    font-family: monospace;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 8px;
  `;const o=document.createElement("code");o.style.cssText=`
    height: 100%;
  `,o.textContent=e;const a=m("copy-branch-name-btn","ms-Icon--Copy","Copy branch name",()=>{navigator.clipboard.writeText(e).then(()=>{p()})}),c=m("regenerate-branch-name-btn","ms-Icon--Refresh","Regenerate branch name",async()=>{const k=f(),u=await v(k);C(t,u),r.remove(),b(u,t,new Date().toISOString()),navigator.clipboard.writeText(u).then(()=>{p()})}),i=m("delete-branch-name-btn","ms-Icon--Delete","Delete branch name",()=>{localStorage.removeItem(`branchName-${t}`),r.remove(),S(t)}),s=document.createElement("span");return s.style.cssText="font-size: 11px; color: #888;",s.textContent=`saved ${B(n)}`,r.appendChild(o),r.appendChild(a),r.appendChild(c),r.appendChild(i),r.appendChild(s),r}function b(e,t,n){const r=document.querySelector("#branch-name-inline");r&&r.remove();const o=document.querySelector(".work-item-form-header a");if(!o)return;const a=f(),c=q(e,t,n),i=E(a);c.appendChild(i);const s=$(a);c.appendChild(s),o.parentElement.appendChild(c)}function S(e){const t=document.querySelector(".work-item-form-header a");if(!t||document.querySelector("#branch-name-generate"))return;const n=document.createElement("button");n.id="branch-name-generate",n.className="bolt-button bolt-default-button bolt-focus-treatment",n.style.cssText="margin-left: 10px; padding: 0px 6px; font-size: 12px;",n.innerText="Generate Branch Name",n.onclick=async()=>{const r=f(),o=await v(r),a=new Date().toISOString();C(e,o),b(o,e,a),navigator.clipboard.writeText(o).then(()=>{p()}),n.remove()},t.parentElement.appendChild(n)}function L(){new MutationObserver(t=>{t.forEach(n=>{n.type==="childList"&&n.addedNodes.forEach(r=>{if(r.nodeType===Node.ELEMENT_NODE){const o=r.querySelector('input[aria-label="Title field"]'),a=r.querySelector(".work-item-form-header a");(o||a)&&setTimeout(async()=>{await h()},100)}})})}).observe(document.body,{childList:!0,subtree:!0})}async function h(e=0){if(!await w())return;const t=document.querySelector('input[aria-label="Title field"]'),n=document.querySelector(".work-item-form-header a");if(t&&n){const r=n.textContent.match(/(\d+)/),o=r?r[1]:null;if(!o)return;const a=T(o);a?.branch&&a?.savedAt?b(a.branch,o,a.savedAt):S(o)}else e<10&&setTimeout(()=>h(e+1),500)}L();h();
